{% extends "layout.html" %}
{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header">Config Files</h1>
            <!--<div class="panel-body">
                <pre style="height: 600px;"><code style="white-space: pre; overflow-x: auto; display: inline-block; min-width: 100%;">{{ logs }}</code>
                </pre>
            </div>-->

        </div>
        <!-- /.col-lg-12 -->
    </div>
    <!-- /.row -->
    <!-- /.row -->
    <div class="row">
        <div class="col-lg-6">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    RL Config File
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                            <pre style="height: 300px;"><code
                                    style="white-space: pre; overflow-x: auto; display: inline-block; min-width: 100%;">{{ config_rl }}</code>
                </pre>
                </div>
            </div>
            <!-- /.panel-body -->
        </div>
        <!-- /.panel -->
        <div class="col-lg-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    RA Config File
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                            <!--<pre style="height: 300px;"><code
                                    style="white-space: pre; overflow-x: auto; display: inline-block; min-width: 100%;">{{ data_config_ra }}</code>-->

    <ul class="nav nav-tabs" ><li class="pull-right"><button id="save" type="button" class="btn btn-block btn-primary btn-sm"  onclick="update(this.id)" ><i class="fa fa-save"></i> Update</button></li>
    </ul>
   <div id="editor"></div>
                <!--</pre>--></div>
            </div>
            <!-- /.panel-body -->
        </div>
        <!-- /.panel -->
    </div>
</div>
<!-- /.container-fluid -->

<script>
    var editorJSON;


     var test = document.getElementById("editor");
     console.log(test);

    function update(e) {

        var type, text;
                type = 'text';
                text = test.textContent;
        console.log(text);
        $.ajax({
            url: "/config/update",
            type: 'POST',
            dataType: 'text',
            data: {
                'type': type,
                'text': text
            },
            success: function (result) {
                $("#success-alert").fadeTo(2000, 500).slideDown(500, function(){
                    setTimeout(function () {
                        $("#success-alert").slideUp(500);
                    }, 2000);

                });
            },
            error: function (result) {
                var data = result.responseJSON;
                var title = "Error " + (data && data.code ? data.code : 'unknown');
                var message = data && data.detail ? data.detail : 'No detail available.';
            }
        });
    }

</script>

    <link rel="stylesheet" href="https://unpkg.com/@datavis-tech/codemirror-6-prerelease@5.0.0/codemirror.next/legacy-modes/style/codemirror.css">
<script src="https://unpkg.com/@datavis-tech/codemirror-6-prerelease@5.0.0/dist/codemirror.js"></script>
<style>
.codemirror { height: 300px; overflow: auto; border: 1px solid silver}
.codemirror-matching-bracket { background: red; }
.codemirror-nonmatching-bracket { background: green; }
</style>

  <script>
    let {
      EditorState,
      EditorView,
      keymap,
      history,
      redo,
      redoSelection,
      undo,
      undoSelection,
      lineNumbers,
      baseKeymap,
      indentSelection,
      legacyMode,
      legacyModes: { javascript },
      matchBrackets,
      specialChars,
      multipleSelections
    } = CodeMirror;

    let mode = legacyMode({mode: javascript({indentUnit: 2}, {})})

    let isMac = /Mac/.test(navigator.platform)
    let state = EditorState.create({doc: `{{ config_rl }}`, extensions: [
      lineNumbers(),
      history(),
      specialChars(),
      multipleSelections(),
      mode,
      matchBrackets(),
      keymap({
        "Mod-z": undo,
        "Mod-Shift-z": redo,
        "Mod-u": view => undoSelection(view) || true,
        [isMac ? "Mod-Shift-u" : "Alt-u"]: redoSelection,
        "Ctrl-y": isMac ? undefined : redo,
        "Shift-Tab": indentSelection
      }),
      keymap(baseKeymap),
    ]})

    let view = new EditorView({state})
    document.querySelector("#editor").appendChild(view.dom)

  </script>
{% endblock %}